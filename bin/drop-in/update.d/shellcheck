#!/bin/bash

tmp_dir="$(mktemp --directory)"
cd "$tmp_dir" || exit 1
trap 'rm -rf "$tmp_dir"; tput bel' ABRT EXIT HUP INT QUIT TERM

if command -v shellcheck >/dev/null; then
  printf 'current version: %s\n\n' "$(shellcheck --version)"
else
  echo 'shellcheck is not currently installed'
fi

# https://github.com/koalaman/shellcheck#installing-a-pre-compiled-binary
scversion='stable'
url="https://github.com/koalaman/shellcheck/releases/download/${scversion?}/shellcheck-${scversion?}.linux.x86_64.tar.xz"
curl --fail --location --show-error --silent "$url" \
  | tar --extract --file=- --xz

cp "shellcheck-$scversion/shellcheck" "$HOME/.local/bin/"
printf 'new version: %s\n\n' "$(shellcheck --version)"

# download man page
curl --fail --location --show-error --silent \
  'https://raw.githubusercontent.com/koalaman/shellcheck/master/shellcheck.1.md' \
  | pandoc --standalone --from=markdown-smart --to=man \
    --output="$HOME/.local/share/man/man1/shellcheck.1" -
