#!/bin/bash

readonly DIR="${0%/*}"
source "$DIR/lib"

if (( curpos == 0 )); then
  printf '%s' "$query"
  set_cursor_position 0
  exit
fi

# shellcheck disable=SC2001
if (( curpos == 1 )); then
  sed 's/\(.\)\(.\)\(.*\)/\2\1\3/' <<<"$query"
  set_cursor_position 2

elif (( curpos == ${#query} )); then
  sed 's/\(.*\)\(.\)\(.\)/\1\3\2/' <<<"$query"

else
  sed 's/\(.\{'$((curpos - 1))'\}\)\(.\)\(.\)\(.*\)/\1\3\2\4/' <<<"$query"
  declare -i new_pos=$((curpos + 1))
  if (( curpos == ${#query} - 1 )); then
    ((new_pos++))
  fi
  set_cursor_position "$new_pos"
fi
