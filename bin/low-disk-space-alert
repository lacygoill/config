#!/bin/bash

declare -i -r MAX_PERCENTAGE=90

readonly SCRIPT="${0##*/}"

df --human-readable \
  | awk '{ print $5 " " $6 }' \
  | sed '1d; s/%//g' \
  | while read -r percentage mountpoint; do
      if (( percentage >= MAX_PERCENTAGE )); then
        printf 'The filesystem at %s is full up to %s%%.\nTry to free some space.\n' \
          "$mountpoint" "$percentage"
      fi
    done \
  | ifne mail --subject="URGENT: $SCRIPT" "$USER"@localhost
