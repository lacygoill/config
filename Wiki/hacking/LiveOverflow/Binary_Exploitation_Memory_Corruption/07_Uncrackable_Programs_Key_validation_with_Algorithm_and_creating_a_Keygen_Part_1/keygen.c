// TODO: Review all of this code.
// TODO: Make the program stop after printing 10 valid keys.

#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<time.h>

#define VALID_SUM 916

    int
sum_chars_from(char key[])
{
    int char_sum = 0;
    for (int i = 0; i < (int)strlen(key); i++)
    {
        char_sum += key[i];
    }
    return (int)char_sum;
}

    int
main(void)
{
    char random_key[16];
    int i;

    for (i = 0; i <= 15; i++)
        random_key[i] = '\0';

    // Need to (down)cast the output of `time()` to `unsigned int` to suppress a warning.{{{
    //
    //     conversion from ‘time_t’ {aka ‘long int’} to ‘unsigned int’ may change value
    //        |     srand(time(NULL));
    //        |           ^~~~~~~~~~
    //
    // That's because  `time()` returns  a `time_t` value  (which is  probably a
    // 64-bit  integer), while  `srand()`  expects an  `unsigned int` (which  is
    // probably a 32-bit integer).
    //
    // Note that this downcast could make us lose some data (specifically the 32
    // high bits of `time()`); but that's not an issue here, because we only use
    // `time()` as  a seed for  a new sequence  of pseudo-random integers  to be
    // returned by `rand()`.
    //
    // https://stackoverflow.com/a/9246559
    //}}}
    srand((unsigned int)time(NULL));

    while(1)
    {
        if (i <= 15)
            random_key[i] = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-_"[rand() % 63];
        else
            goto reset;

        i++;
        int sum = sum_chars_from(random_key);

        if (sum == VALID_SUM)
            printf("Found valid license key: %s\n", random_key);
        else if (sum > VALID_SUM)
        {
            reset:
            for (i = 0; i <= 15; i++)
                random_key[i] = '\0';
            i = 0;
        }
    }

    return 0;
}
