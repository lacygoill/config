// Purpose: crack a program asking for a valid license key
// Test: `$ gcc license_2.c -o build/license_2 $GCC_OPTS && ./build/license_2 TEST-KEY-1234`
// Input: an arbitrary key
// Output: "Access Granted!" or "WRONG!"
// References:
// https://www.youtube.com/watch?v=qS4VWL5R_OM
// https://github.com/LiveOverflow/liveoverflow_youtube/blob/master/0x07_0x08_uncrackable_crackme/license_2.c


#include <stdio.h>
#include <string.h>

#define VALID_SUM 916
//                ^^^
// This number can be found by adding a `printf()` in the code:{{{
//
//     printf("the correct sum is: %d\n", sum);
//
// Then starting the binary with the valid key:
//
//     $ ./build/'license_2' AAAA-Z10N-42-OK
//     Checking License: AAAA-Z10N-42-OK
//     916
//}}}


    int
main(int argc, char *argv[])
{
    if (argc != 2)
    {
        printf("Usage: <key>\n");
        return 1;
    }

    int sum = 0;
    char *key = argv[1];
    // Need to cast `keylen` to `int` to suppress a warning.{{{
    //
    //     conversion from ‘size_t’ {aka ‘long unsigned int’} to ‘int’ may change value
    //           |         int keylen = strlen(key);
    //           |                      ^~~~~~
    //}}}
    int keylen = (int)strlen(key);

    printf("Checking License: %s\n", key);

    for (int i = 0; i < keylen; i++)
    {
        sum += key[i];
    }

    // We could also compare the supplied key to the valid one, but we don't.{{{
    //
    //     if (strcmp(key, "THE VALID KEY") == 0)
    //
    // It would make it  too easy for a hacker to find  the key; for example
    // using `strings(1)`.  So,  instead of comparing the  keys directly, we
    // compare the sums of their characters.
    //}}}
    if (sum == VALID_SUM)
    {
        printf("Access Granted!\n");
    }
    else
    {
        printf("WRONG!\n");
    }

    return 0;
}
